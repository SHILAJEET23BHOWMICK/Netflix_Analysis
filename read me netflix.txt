#1)checking the number of movies and tv shows

SELECT TYPE,COUNT(*) FROM MOVIE_SHOWS
GROUP BY TYPE;


#2)checking the most common type of rating
SELECT TYPE,
       RATING
FROM (
    SELECT TYPE,
           RATING,
           COUNT(*) AS CNT,
           RANK() OVER (PARTITION BY TYPE ORDER BY COUNT(*) DESC) AS RANKING
    FROM MOVIE_SHOWS
    GROUP BY 1, 2
) AS T1
WHERE RANKING = 1;

#here we cannot use max(rating ) because rating  is string here

#3)listing all the movies on a specific year 
we will ask the year from the user and then.its not pre specified


DELIMITER //

CREATE PROCEDURE mov(IN input_year INT)
BEGIN
    SELECT * 
    FROM movie_shows
    WHERE type = 'Movie'
      AND release_year = input_year;
END //

DELIMITER ;

call mov( specific year);


delimiter;

#4) Find the top 5 countires with most content on netflix.
SELECT TRIM(jt.country) AS country,
       COUNT(ms.show_id) AS total_count
FROM movie_shows ms
JOIN JSON_TABLE(
        CONCAT('["', REPLACE(ms.country, ',', '","'), '"]'),
        '$[*]' COLUMNS(country VARCHAR(100) PATH '$')
     ) jt
ON TRUE
GROUP BY TRIM(jt.country)
ORDER BY total_count DESC
LIMIT 5;

#here we will get count of rows where the country is null so we will add condition 
SELECT TRIM(jt.country) AS country,
       COUNT(ms.show_id) AS total_count
FROM movie_shows ms
JOIN JSON_TABLE(
        CONCAT('["', REPLACE(ms.country, ',', '","'), '"]'),
        '$[*]' COLUMNS(country VARCHAR(100) PATH '$')
     ) jt
ON TRUE
WHERE jt.country is not null and trim(jt.country) <> ''
GROUP BY TRIM(jt.country)
ORDER BY total_count DESC
LIMIT 5;

6) Identify the longest movie;
SELECT 
    title,
    type,
    CAST(TRIM(REPLACE(duration, 'min', '')) AS UNSIGNED) AS minutes
FROM movie_shows
WHERE type = 'Movie'
  AND duration LIKE '%min%'
ORDER BY minutes DESC
LIMIT 1;


7)List  the movies that was added in 5 years

select COUNT(*) from movie_shows
where str_to_date(date_added,'%M %d,%Y') >=CURDATE()- INTERVAL 5 YEAR;


8) List the TV Shows more than 5 Seasons
SELECT * FROM MOVIE_SHOWS 
WHERE TYPE='TV SHOW'
and CAST(SUBSTRING_INDEX(DURATION, '  ', 1 ) AS UNSIGNED) >5;

9)Count the Number of Content Items in Each Genre
SELECT 
    TRIM(jt.genre) AS genre,
    COUNT(*) AS total_content
FROM movie_shows ms
JOIN JSON_TABLE(
        CONCAT('["', REPLACE(ms.listed_in, ',', '","'), '"]'),
        '$[*]' COLUMNS (genre VARCHAR(255) PATH '$')
     ) jt
ON TRUE
WHERE jt.genre IS NOT NULL 
  AND TRIM(jt.genre) <> ''
GROUP BY TRIM(jt.genre)
ORDER BY total_content DESC;

10)Find each year and the average numbers of content release in India on netflix.
return top 5 year with highest avg content release!

SELECT
    country,
    release_year,
    COUNT(show_id) AS total,
    ROUND(
        COUNT(show_id) * 100.0 /
        (SELECT COUNT(show_id) FROM movie_shows WHERE country = 'India'),
        2
    ) AS avg_release
FROM movie_shows
WHERE country = 'India'
GROUP BY country, release_year
ORDER BY avg_release DESC
LIMIT 5;


11) LIST ALL THE SHOWS WITH DOCUMENTRY GENRE

SELECT TITLE 
FROM MOVIE_SHOWS
WHERE LISTED_IN COLLATE utf8mb4_general_ci LIKE '%Documentaries%';


12)Find How Many Movies Actor 'Salman Khan' Appeared in the Last 10 Years
SELECT * 
FROM MOVIE_SHOWS 
WHERE casts COLLATE utf8mb4_general_ci LIKE '%Salman Khan%'
  AND release_year > YEAR(CURDATE()) - 10;

13)Find the Top 10 Actors Who Have Appeared in the Highest Number of Movies Produced in India
SELECT 
    TRIM(jt.casts) AS casts_,
    COUNT(*) AS appearance
FROM movie_shows ms
JOIN JSON_TABLE(
    CONCAT('["', REPLACE(COALESCE(ms.casts, ''), ',', '","'), '"]'),
    '$[*]' COLUMNS (
        casts VARCHAR(255) PATH '$'
    )
) AS jt ON TRUE
WHERE ms.country = 'India'
  AND jt.casts IS NOT NULL
  AND TRIM(jt.casts) <> ''
GROUP BY casts_
ORDER BY appearance DESC
LIMIT 10;

14)Show Titles Containing 'Love' and Their Release Dates

SELECT TITLE,RELEASE_YEAR
FROM MOVIE_SHOWS
WHERE TITLE LIKE '%Love%
GROUP BY TITLE ;


15)Categorize Content Based on the User Presence of 2 words
DELIMITER //

CREATE PROCEDURE categorize_content_counts_dynamic23(
    IN keyword1 VARCHAR(100),
    IN keyword2 VARCHAR(100),
    IN output1 VARCHAR(100),
    IN output2 VARCHAR(100)
)
BEGIN
    SELECT CATEGORY, COUNT(*) AS COUNT_OF_CATEGORY
    FROM (
        SELECT 
            CASE
                WHEN DESCRIPTION LIKE CONCAT('%', keyword1, '%') 
                     OR DESCRIPTION LIKE CONCAT('%', keyword2, '%') THEN output1
                ELSE output2
            END AS CATEGORY
        FROM MOVIE_SHOWS
    ) AS CATEGORISED_CONTENT
    GROUP BY CATEGORY;
END
//

DELIMITER ;

call categorize_content_count_dynamic23(keyword1,keyword2,output1,output2)

#here when we call the precdedure make sure we put the words are in ' ';










